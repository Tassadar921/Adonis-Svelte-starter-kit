FROM node:22

WORKDIR /app

# Accept the FRONT_PORT build arg
ARG FRONT_PORT

# Copy frontend dependencies
COPY front/package*.json ./

# Install frontend deps
RUN npm install

# Copy frontend app code
COPY front /app

# Also copy root-level shared tools (optional)
COPY package*.json /shared/

RUN chown -R node:node /app

EXPOSE ${FRONT_PORT}

USER node

CMD ["npm", "run", "dev"]
